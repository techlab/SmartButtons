/* 
 * Smart Buttons 1.0
 * Social buttons for GitHub
 * by Dipu Raj
 * http://www.techlaboratory.net 
 * 
 * Inspired from:
 * http://markdotto.github.com/github-buttons/
 * 
 */
(function(b){b.fn.smartButtons=function(e){var a=b.extend({},b.fn.smartButtons.defaults,e);return this.each(function(){function p(a,b){resStr=a.split("{");var c="";for(i=0;i<resStr.length;i++){var d=resStr[i];valRef=d.substring(0,d.indexOf("}"));if(""!=valRef||null!=valRef){var e=b[valRef];if(null==e||"undefined"==e)e="";d=d.replace(valRef+"}",e)}c+=d}return c}var c=b(this);c.addClass("s-buttons").addClass("s-buttons-"+a.size);var h=b("<ul></ul>"),r="https://api.github.com/users/"+a.user,s="https://api.github.com/repos/"+ a.user+"/"+a.repo,f="https://github.com/"+a.user,q="https://github.com/"+a.user+"/"+a.repo,j="https://github.com/"+a.user+"/"+a.repo+"/stargazers",k="https://github.com/"+a.user+"/"+a.repo+"/network";if(!e||"init"===e||"object"===typeof e)if(0<a.user.length){if(a.followButton.show){var d=b('<li class="follow"></li>'),g=p(a.followButton.text,a);d.append(b('<a class="button" href="'+f+'" target="'+a.target+'"><span class="icon"></span>'+g+"</a>"));h.append(d)}0<a.repo.length&&(a.forkButton.show&&(d= b('<li class="fork"></li>'),g=p(a.forkButton.text,a),d.append(b('<a class="button" href="'+q+'" target="'+a.target+'"><span class="icon"></span>'+g+"</a>")),h.append(d)),a.starButton.show&&(d=b('<li class="star"></li>'),g=p(a.starButton.text,a),d.append(b('<a class="button" href="'+q+'" target="'+a.target+'"><span class="icon"></span>'+g+"</a>")),h.append(d)));c.append(h);if(a.followButton.count&&a.followButton.show){var l=b("li.follow",c);c.data("followers")&&a.cache?"large"==a.size?l.prepend('<a class="count" href="'+ f+'" target="'+a.target+'"><span class="arrow"></span>'+c.data("followers")+"</a>"):l.append('<a class="count" href="'+f+'" target="'+a.target+'"><span class="arrow"></span>'+c.data("followers")+"</a>"):b.ajax({url:r,data:{},dataType:"jsonp",success:function(b){b.data&&("large"==a.size?l.prepend('<a class="count" href="'+f+'" target="'+a.target+'"><span class="arrow"></span>'+b.data.followers+"</a>"):l.append('<a class="count" href="'+f+'" target="'+a.target+'"><span class="arrow"></span>'+b.data.followers+ "</a>"),c.data("followers",b.data.followers))},error:function(a){b.error("Follow Count Error: "+a)}})}if(0<a.repo.length&&(a.forkButton.count||a.starButton.count)&&(a.forkButton.show||a.starButton.show)){var m=b("li.star",c),n=b("li.fork",c);c.data("watchers")&&c.data("forks")&&a.cache?(a.starButton.count&&a.starButton.show&&("large"==a.size?m.prepend('<a class="count" href="'+j+'" target="'+a.target+'"><span class="arrow"></span>'+c.data("watchers")+"</a>"):m.append('<a class="count" href="'+j+'" target="'+ a.target+'"><span class="arrow"></span>'+c.data("watchers")+"</a>")),a.forkButton.count&&a.forkButton.show&&("large"==a.size?n.prepend('<a class="count" href="'+k+'" target="'+a.target+'"><span class="arrow"></span>'+c.data("forks")+"</a>"):n.append('<a class="count" href="'+k+'" target="'+a.target+'"><span class="arrow"></span>'+c.data("forks")+"</a>"))):b.ajax({url:s,data:{},dataType:"jsonp",success:function(b){b.data&&(a.starButton.count&&a.starButton.show&&("large"==a.size?m.prepend('<a class="count" href="'+ j+'" target="'+a.target+'"><span class="arrow"></span>'+b.data.watchers+"</a>"):m.append('<a class="count" href="'+j+'" target="'+a.target+'"><span class="arrow"></span>'+b.data.watchers+"</a>")),a.forkButton.count&&a.forkButton.show&&("large"==a.size?n.prepend('<a class="count" href="'+k+'" target="'+a.target+'"><span class="arrow"></span>'+b.data.forks+"</a>"):n.append('<a class="count" href="'+k+'" target="'+a.target+'"><span class="arrow"></span>'+b.data.forks+"</a>")),c.data("forks",b.data.forks), c.data("watchers",b.data.starers))},error:function(a){b.error("Repo Count Error: "+a)}})}}else b.error("Missing required user");else b.error("Method "+e+" does not exist")})};b.fn.smartButtons.defaults={user:"",repo:"",size:"large",cache:!1,target:"_blank",forkButton:{show:!0,count:!0,text:"Fork {repo}"},starButton:{show:!0,count:!0,text:"Star {repo}"},followButton:{show:!0,count:!0,text:"Follow {user}"}}})(jQuery);